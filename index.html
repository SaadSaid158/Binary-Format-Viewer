<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binary Format Viewer with VirusTotal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap');
        
        body {
            font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            color: #e2e8f0;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 1rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }
        
        .drop-area {
            border: 2px dashed #4a5568;
            border-radius: 1.5rem;
            padding: 4rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            background: rgba(30, 41, 59, 0.5);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .drop-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .drop-area.hover {
            background: rgba(59, 130, 246, 0.1);
            border-color: #3b82f6;
            transform: scale(1.02);
            box-shadow: 0 0 50px rgba(59, 130, 246, 0.3);
        }
        
        .drop-area.hover::before {
            left: 100%;
        }
        
        .hex-dump-container {
            background: rgba(15, 23, 42, 0.9);
            border-radius: 1rem;
            padding: 1.5rem;
            overflow-y: auto;
            max-height: 600px;
            font-family: 'JetBrains Mono', 'Courier New', monospace;
            white-space: pre;
            font-size: 0.875rem;
            line-height: 1.6;
            border: 1px solid rgba(59, 130, 246, 0.2);
            position: relative;
        }
        
        .hex-dump-container::-webkit-scrollbar {
            width: 8px;
        }
        
        .hex-dump-container::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 4px;
        }
        
        .hex-dump-container::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 4px;
        }
        
        .hex-dump-container::-webkit-scrollbar-thumb:hover {
            background: rgba(59, 130, 246, 0.7);
        }
        
        .info-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(59, 130, 246, 0.4);
        }
        
        .threat-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.875rem;
            animation: pulse 2s infinite;
        }
        
        .threat-high { 
            background: rgba(239, 68, 68, 0.2); 
            color: #ef4444; 
            border: 1px solid #ef4444;
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.3);
        }
        
        .threat-medium { 
            background: rgba(245, 158, 11, 0.2); 
            color: #f59e0b; 
            border: 1px solid #f59e0b;
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.3);
        }
        
        .threat-low { 
            background: rgba(16, 185, 129, 0.2); 
            color: #10b981; 
            border: 1px solid #10b981;
        }
        
        .threat-clean { 
            background: rgba(34, 197, 94, 0.2); 
            color: #22c55e; 
            border: 1px solid #22c55e;
        }
        
        .entropy-bar {
            height: 24px;
            border-radius: 12px;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }
        
        .entropy-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }
        
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        .entropy-high { 
            background: linear-gradient(90deg, #ef4444, #dc2626);
            box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
        }
        
        .entropy-medium { 
            background: linear-gradient(90deg, #f59e0b, #d97706);
            box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
        }
        
        .entropy-low { 
            background: linear-gradient(90deg, #10b981, #059669);
            box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
        }
        
        .detection-badge {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.375rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.25rem;
            transition: all 0.3s ease;
            cursor: default;
        }
        
        .detection-badge:hover {
            transform: scale(1.05);
        }
        
        .badge-malware { 
            background: rgba(239, 68, 68, 0.2); 
            color: #ef4444; 
            border: 1px solid #ef4444;
            animation: pulse 2s infinite;
        }
        
        .badge-suspicious { 
            background: rgba(245, 158, 11, 0.2); 
            color: #f59e0b; 
            border: 1px solid #f59e0b;
        }
        
        .badge-clean { 
            background: rgba(16, 185, 129, 0.2); 
            color: #10b981; 
            border: 1px solid #10b981;
        }
        
        .badge-format { 
            background: rgba(59, 130, 246, 0.2); 
            color: #3b82f6; 
            border: 1px solid #3b82f6;
        }
        
        .badge-system { 
            background: rgba(168, 85, 247, 0.2); 
            color: #a855f7; 
            border: 1px solid #a855f7;
        }
        
        .section-analysis {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .section-analysis::-webkit-scrollbar {
            width: 6px;
        }
        
        .section-analysis::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 3px;
        }
        
        .section-analysis::-webkit-scrollbar-thumb {
            background: rgba(59, 130, 246, 0.5);
            border-radius: 3px;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(59, 130, 246, 0.3);
            border-radius: 50%;
            border-top-color: #3b82f6;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(30, 41, 59, 0.5);
            border-radius: 2px;
            overflow: hidden;
            margin: 1rem 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            border-radius: 2px;
            transition: width 0.3s ease;
        }
        
        .tab-container {
            display: flex;
            border-bottom: 1px solid rgba(59, 130, 246, 0.2);
            margin-bottom: 1rem;
        }
        
        .tab {
            padding: 0.75rem 1.5rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        
        .tab.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }
        
        .tab:hover:not(.active) {
            background: rgba(59, 130, 246, 0.05);
        }
        
        .floating-action {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .floating-action:hover {
            transform: scale(1.1);
            box-shadow: 0 15px 40px rgba(59, 130, 246, 0.4);
        }
        
        .tooltip {
            position: relative;
            cursor: help;
        }
        
        .tooltip::after {
            content: attr(data-tooltip);
            position: absolute;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(15, 23, 42, 0.95);
            color: #e2e8f0;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.75rem;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 1000;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        
        .tooltip:hover::after {
            opacity: 1;
            visibility: visible;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .stat-item {
            background: rgba(15, 23, 42, 0.5);
            padding: 1rem;
            border-radius: 0.75rem;
            border: 1px solid rgba(59, 130, 246, 0.1);
            text-align: center;
            transition: all 0.3s ease;
        }
        
        .stat-item:hover {
            border-color: rgba(59, 130, 246, 0.3);
            transform: translateY(-2px);
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #3b82f6;
            font-family: 'JetBrains Mono', monospace;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #94a3b8;
            margin-top: 0.25rem;
        }

        /* VirusTotal specific styles */
        .vt-section {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 1rem;
            padding: 1.5rem;
            border: 1px solid rgba(59, 130, 246, 0.2);
            margin-bottom: 1rem;
        }

        .vt-engine {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem;
            margin: 0.25rem 0;
            border-radius: 0.5rem;
            background: rgba(30, 41, 59, 0.5);
        }

        .vt-clean { border-left: 4px solid #10b981; }
        .vt-malicious { border-left: 4px solid #ef4444; }
        .vt-suspicious { border-left: 4px solid #f59e0b; }
        .vt-undetected { border-left: 4px solid #6b7280; }

        /* PDF Export Styles */
        .pdf-content {
            background: white;
            color: black;
            padding: 2rem;
            font-family: Arial, sans-serif;
        }

        .pdf-header {
            text-align: center;
            border-bottom: 2px solid #3b82f6;
            padding-bottom: 1rem;
            margin-bottom: 2rem;
        }

        .pdf-section {
            margin-bottom: 2rem;
            page-break-inside: avoid;
        }

        .pdf-section h3 {
            color: #3b82f6;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }

        .pdf-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
        }

        .pdf-table th,
        .pdf-table td {
            border: 1px solid #e5e7eb;
            padding: 0.5rem;
            text-align: left;
        }

        .pdf-table th {
            background-color: #f3f4f6;
            font-weight: bold;
        }

        .threat-high-pdf { color: #dc2626; font-weight: bold; }
        .threat-medium-pdf { color: #d97706; font-weight: bold; }
        .threat-low-pdf { color: #059669; font-weight: bold; }
        .threat-clean-pdf { color: #16a34a; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="text-center mb-8">
            <div class="glass-card p-8">
                <h1 class="text-5xl font-bold bg-gradient-to-r from-blue-400 via-purple-500 to-pink-500 bg-clip-text text-transparent mb-4">
                    <i class="fas fa-microscope mr-3"></i>
                    Binary Format Viewer with VirusTotal
                </h1>
                <p class="text-gray-400 text-xl">Advanced binary analysis with VirusTotal threat intelligence</p>
                <div class="flex justify-center items-center gap-4 mt-4">
                    <span class="detection-badge badge-format">
                        <i class="fas fa-shield-alt"></i>
                        VirusTotal Integration
                    </span>
                    <span class="detection-badge badge-system">
                        <i class="fas fa-chart-line"></i>
                        Entropy Visualization
                    </span>
                    <span class="detection-badge badge-clean">
                        <i class="fas fa-search"></i>
                        Format Detection
                    </span>
                </div>
            </div>
        </header>

        <!-- File Input Area -->
        <div id="drop-area" class="drop-area mb-8 glass-card">
            <div class="text-6xl mb-4">
                <i class="fas fa-cloud-upload-alt text-blue-400"></i>
            </div>
            <h3 class="text-2xl font-semibold text-gray-300 mb-4">Drop your binary file here</h3>
            <p class="text-lg text-gray-400 mb-6">Supports executables, archives, images, and more</p>
            <input type="file" id="file-input" class="hidden">
            <label for="file-input" class="inline-flex items-center gap-2 px-8 py-4 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl cursor-pointer hover:from-blue-700 hover:to-purple-700 transition font-semibold text-lg shadow-lg">
                <i class="fas fa-folder-open"></i>
                Browse Files
            </label>
            <div id="file-info" class="mt-6 text-gray-300"></div>
            <div id="progress-container" class="hidden">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
                </div>
                <p class="text-sm text-gray-400 text-center">Analyzing file...</p>
            </div>
        </div>

        <!-- VirusTotal Results -->
        <div id="virustotal-results" class="hidden mb-8">
            <div class="glass-card p-6">
                <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-shield-virus text-blue-400"></i>
                    VirusTotal Analysis
                </h2>
                
                <div id="vt-summary" class="mb-6">
                    <!-- Summary will be populated here -->
                </div>

                <div class="tab-container">
                    <div class="tab active" onclick="switchVTTab('engines')">Detection Engines</div>
                    <div class="tab" onclick="switchVTTab('details')">File Details</div>
                </div>

                <div id="vt-engines" class="vt-section">
                    <!-- Engine results will be populated here -->
                </div>

                <div id="vt-details" class="vt-section hidden">
                    <!-- File details will be populated here -->
                </div>
            </div>
        </div>

        <!-- Quick Stats -->
        <div id="quick-stats" class="hidden mb-8">
            <div class="glass-card p-6">
                <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                    <i class="fas fa-chart-bar text-blue-400"></i>
                    Quick Analysis
                </h2>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="file-size">0 KB</div>
                        <div class="stat-label">File Size</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="file-entropy">0.0</div>
                        <div class="stat-label">Entropy</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="file-format">Unknown</div>
                        <div class="stat-label">Format</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="threat-level">Analyzing...</div>
                        <div class="stat-label">Threat Level</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Results -->
        <div id="analysis-results" class="hidden">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-8">
                <!-- File Information -->
                <div class="info-card">
                    <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <i class="fas fa-info-circle text-blue-400"></i>
                        File Information
                    </h3>
                    <div id="file-details" class="space-y-3">
                        <!-- File details will be populated here -->
                    </div>
                </div>

                <!-- Entropy Analysis -->
                <div class="info-card">
                    <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
                        <i class="fas fa-wave-square text-purple-400"></i>
                        Entropy Analysis
                    </h3>
                    <div class="space-y-4">
                        <div>
                            <div class="flex justify-between mb-2">
                                <span class="text-sm text-gray-400">Overall Entropy</span>
                                <span class="text-sm font-mono" id="entropy-value">0.0</span>
                            </div>
                            <div class="entropy-bar entropy-low" id="entropy-bar"></div>
                        </div>
                        <canvas id="entropy-chart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Hex Dump -->
            <div class="glass-card p-6 mb-8">
                <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <i class="fas fa-code text-green-400"></i>
                    Hex Dump
                </h3>
                <div id="hex-dump" class="hex-dump-container">
                    <!-- Hex dump will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Export Button -->
    <div class="floating-action" onclick="exportToPDF()" title="Export to PDF">
        <i class="fas fa-download text-white text-xl"></i>
    </div>

    <script>
        // VirusTotal API Configuration
        const VIRUSTOTAL_API_KEY = 'ff27f89f4258aa7842ab9583f4314d14c44256b702415df9c395f703e1ca7619';
        const VIRUSTOTAL_API_BASE = 'https://www.virustotal.com/api/v3';

        // Global variables
        let currentFile = null;
        let virusTotalData = null;

        // File handling
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');

        // Drag and drop handlers
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('hover');
        });

        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('hover');
        });

        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('hover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        // Calculate SHA256 hash of file
        async function calculateSHA256(file) {
            return new Promise((resolve) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const arrayBuffer = e.target.result;
                    const wordArray = CryptoJS.lib.WordArray.create(arrayBuffer);
                    const hash = CryptoJS.SHA256(wordArray).toString();
                    resolve(hash);
                };
                reader.readAsArrayBuffer(file);
            });
        }

        // VirusTotal API functions
        async function checkVirusTotal(hash) {
            try {
                const response = await fetch(`${VIRUSTOTAL_API_BASE}/files/${hash}`, {
                    headers: {
                        'x-apikey': VIRUSTOTAL_API_KEY
                    }
                });

                if (response.status === 404) {
                    // File not found in VirusTotal database
                    return null;
                }

                if (!response.ok) {
                    throw new Error(`VirusTotal API error: ${response.status}`);
                }

                const data = await response.json();
                return data;
            } catch (error) {
                console.error('VirusTotal API error:', error);
                return null;
            }
        }

        // Display VirusTotal results
        function displayVirusTotalResults(data) {
            if (!data) {
                document.getElementById('virustotal-results').innerHTML = `
                    <div class="glass-card p-6">
                        <h2 class="text-2xl font-bold mb-4 flex items-center gap-2">
                            <i class="fas fa-shield-virus text-blue-400"></i>
                            VirusTotal Analysis
                        </h2>
                        <div class="text-center py-8">
                            <i class="fas fa-question-circle text-gray-400 text-4xl mb-4"></i>
                            <p class="text-gray-400">File not found in VirusTotal database</p>
                            <p class="text-sm text-gray-500 mt-2">This file has not been analyzed by VirusTotal yet</p>
                        </div>
                    </div>
                `;
                document.getElementById('virustotal-results').classList.remove('hidden');
                return;
            }

            virusTotalData = data;
            const attributes = data.data.attributes;
            const stats = attributes.last_analysis_stats;
            
            // Calculate threat level
            const malicious = stats.malicious || 0;
            const suspicious = stats.suspicious || 0;
            const total = Object.values(stats).reduce((a, b) => a + b, 0);
            
            let threatLevel = 'Clean';
            let threatClass = 'threat-clean';
            
            if (malicious > 0) {
                threatLevel = 'High Risk';
                threatClass = 'threat-high';
            } else if (suspicious > 0) {
                threatLevel = 'Suspicious';
                threatClass = 'threat-medium';
            }

            // Update threat level in quick stats
            document.getElementById('threat-level').textContent = threatLevel;
            document.getElementById('threat-level').className = `stat-value ${threatClass}`;

            // Summary
            const summaryHTML = `
                <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                    <div class="text-center">
                        <div class="text-2xl font-bold text-red-400">${stats.malicious || 0}</div>
                        <div class="text-sm text-gray-400">Malicious</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-yellow-400">${stats.suspicious || 0}</div>
                        <div class="text-sm text-gray-400">Suspicious</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-green-400">${stats.harmless || 0}</div>
                        <div class="text-sm text-gray-400">Clean</div>
                    </div>
                    <div class="text-center">
                        <div class="text-2xl font-bold text-gray-400">${stats.undetected || 0}</div>
                        <div class="text-sm text-gray-400">Undetected</div>
                    </div>
                </div>
                <div class="threat-indicator ${threatClass}">
                    <i class="fas fa-shield-alt"></i>
                    ${threatLevel}
                </div>
            `;

            document.getElementById('vt-summary').innerHTML = summaryHTML;

            // Engine results
            const engines = attributes.last_analysis_results;
            let enginesHTML = '';
            
            Object.entries(engines).forEach(([engine, result]) => {
                let resultClass = 'vt-undetected';
                let resultText = result.result || 'Clean';
                let resultIcon = 'fas fa-check-circle text-green-400';
                
                if (result.category === 'malicious') {
                    resultClass = 'vt-malicious';
                    resultIcon = 'fas fa-exclamation-triangle text-red-400';
                } else if (result.category === 'suspicious') {
                    resultClass = 'vt-suspicious';
                    resultIcon = 'fas fa-question-circle text-yellow-400';
                }
                
                enginesHTML += `
                    <div class="vt-engine ${resultClass}">
                        <div class="flex items-center gap-2">
                            <i class="${resultIcon}"></i>
                            <span class="font-medium">${engine}</span>
                        </div>
                        <div class="text-sm text-gray-300">${resultText}</div>
                    </div>
                `;
            });

            document.getElementById('vt-engines').innerHTML = enginesHTML;

            // File details
            const detailsHTML = `
                <div class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold text-blue-400 mb-2">Hashes</h4>
                            <div class="space-y-1 text-sm font-mono">
                                <div><span class="text-gray-400">MD5:</span> ${attributes.md5}</div>
                                <div><span class="text-gray-400">SHA1:</span> ${attributes.sha1}</div>
                                <div><span class="text-gray-400">SHA256:</span> ${attributes.sha256}</div>
                            </div>
                        </div>
                        <div>
                            <h4 class="font-semibold text-blue-400 mb-2">Analysis Info</h4>
                            <div class="space-y-1 text-sm">
                                <div><span class="text-gray-400">First Seen:</span> ${new Date(attributes.first_submission_date * 1000).toLocaleDateString()}</div>
                                <div><span class="text-gray-400">Last Analysis:</span> ${new Date(attributes.last_analysis_date * 1000).toLocaleDateString()}</div>
                                <div><span class="text-gray-400">Times Submitted:</span> ${attributes.times_submitted}</div>
                            </div>
                        </div>
                    </div>
                    ${attributes.names ? `
                        <div>
                            <h4 class="font-semibold text-blue-400 mb-2">Known Names</h4>
                            <div class="flex flex-wrap gap-2">
                                ${attributes.names.slice(0, 10).map(name => `<span class="detection-badge badge-format">${name}</span>`).join('')}
                            </div>
                        </div>
                    ` : ''}
                </div>
            `;

            document.getElementById('vt-details').innerHTML = detailsHTML;
            document.getElementById('virustotal-results').classList.remove('hidden');
        }

        // Switch VirusTotal tabs
        function switchVTTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // Show/hide content
            document.getElementById('vt-engines').classList.toggle('hidden', tabName !== 'engines');
            document.getElementById('vt-details').classList.toggle('hidden', tabName !== 'details');
        }

        // Main file handler
        async function handleFile(file) {
            currentFile = file;
            
            // Show progress
            document.getElementById('progress-container').classList.remove('hidden');
            document.getElementById('progress-fill').style.width = '10%';
            
            // Update file info
            document.getElementById('file-info').innerHTML = `
                <div class="text-center">
                    <p class="font-semibold">${file.name}</p>
                    <p class="text-gray-400">${formatFileSize(file.size)} • ${file.type || 'Unknown type'}</p>
                </div>
            `;

            // Calculate hash
            document.getElementById('progress-fill').style.width = '30%';
            const hash = await calculateSHA256(file);
            
            // Check VirusTotal
            document.getElementById('progress-fill').style.width = '60%';
            const vtData = await checkVirusTotal(hash);
            
            // Process file for local analysis
            document.getElementById('progress-fill').style.width = '80%';
            await processFile(file);
            
            // Display VirusTotal results
            displayVirusTotalResults(vtData);
            
            // Complete
            document.getElementById('progress-fill').style.width = '100%';
            setTimeout(() => {
                document.getElementById('progress-container').classList.add('hidden');
            }, 500);
        }

        // Process file for local analysis
        async function processFile(file) {
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const arrayBuffer = e.target.result;
                const uint8Array = new Uint8Array(arrayBuffer);
                
                // Update quick stats
                document.getElementById('file-size').textContent = formatFileSize(file.size);
                
                // Calculate entropy
                const entropy = calculateEntropy(uint8Array);
                document.getElementById('file-entropy').textContent = entropy.toFixed(2);
                document.getElementById('entropy-value').textContent = entropy.toFixed(2);
                
                // Update entropy bar
                const entropyBar = document.getElementById('entropy-bar');
                entropyBar.className = 'entropy-bar ' + getEntropyClass(entropy);
                
                // Detect format
                const format = detectFileFormat(uint8Array);
                document.getElementById('file-format').textContent = format;
                
                // Generate hex dump
                generateHexDump(uint8Array);
                
                // Update file details
                updateFileDetails(file, uint8Array);
                
                // Generate entropy chart
                generateEntropyChart(uint8Array);
                
                // Show results
                document.getElementById('quick-stats').classList.remove('hidden');
                document.getElementById('analysis-results').classList.remove('hidden');
            };
            
            reader.readAsArrayBuffer(file);
        }

        // Calculate entropy
        function calculateEntropy(data) {
            const frequency = new Array(256).fill(0);
            
            for (let i = 0; i < data.length; i++) {
                frequency[data[i]]++;
            }
            
            let entropy = 0;
            for (let i = 0; i < 256; i++) {
                if (frequency[i] > 0) {
                    const p = frequency[i] / data.length;
                    entropy -= p * Math.log2(p);
                }
            }
            
            return entropy;
        }

        // Get entropy class for styling
        function getEntropyClass(entropy) {
            if (entropy > 7.5) return 'entropy-high';
            if (entropy > 6.0) return 'entropy-medium';
            return 'entropy-low';
        }

        // Detect file format
        function detectFileFormat(data) {
            const signatures = {
                'PE': [0x4D, 0x5A], // MZ
                'ELF': [0x7F, 0x45, 0x4C, 0x46],
                'PDF': [0x25, 0x50, 0x44, 0x46],
                'ZIP': [0x50, 0x4B, 0x03, 0x04],
                'PNG': [0x89, 0x50, 0x4E, 0x47],
                'JPEG': [0xFF, 0xD8, 0xFF],
                'GIF': [0x47, 0x49, 0x46, 0x38]
            };
            
            for (const [format, signature] of Object.entries(signatures)) {
                if (data.length >= signature.length) {
                    let match = true;
                    for (let i = 0; i < signature.length; i++) {
                        if (data[i] !== signature[i]) {
                            match = false;
                            break;
                        }
                    }
                    if (match) return format;
                }
            }
            
            return 'Unknown';
        }

        // Generate hex dump
        function generateHexDump(data) {
            const maxBytes = Math.min(data.length, 1024); // Limit to first 1KB
            let hexDump = '';
            
            for (let i = 0; i < maxBytes; i += 16) {
                const offset = i.toString(16).padStart(8, '0').toUpperCase();
                let hexPart = '';
                let asciiPart = '';
                
                for (let j = 0; j < 16 && i + j < maxBytes; j++) {
                    const byte = data[i + j];
                    hexPart += byte.toString(16).padStart(2, '0').toUpperCase() + ' ';
                    asciiPart += (byte >= 32 && byte <= 126) ? String.fromCharCode(byte) : '.';
                }
                
                hexPart = hexPart.padEnd(48, ' ');
                hexDump += `${offset}  ${hexPart} |${asciiPart}|\n`;
            }
            
            if (data.length > maxBytes) {
                hexDump += '\n... (truncated)';
            }
            
            document.getElementById('hex-dump').textContent = hexDump;
        }

        // Update file details
        function updateFileDetails(file, data) {
            const details = [
                { label: 'Name', value: file.name },
                { label: 'Size', value: formatFileSize(file.size) },
                { label: 'Type', value: file.type || 'Unknown' },
                { label: 'Modified', value: file.lastModified ? new Date(file.lastModified).toLocaleString() : 'Unknown' },
                { label: 'Entropy', value: calculateEntropy(data).toFixed(2) },
                { label: 'Format', value: detectFileFormat(data) }
            ];
            
            const detailsHTML = details.map(detail => 
                `<div class="flex justify-between">
                    <span class="text-gray-400">${detail.label}:</span>
                    <span class="font-mono">${detail.value}</span>
                </div>`
            ).join('');
            
            document.getElementById('file-details').innerHTML = detailsHTML;
        }

        // Generate entropy chart
        function generateEntropyChart(data) {
            const canvas = document.getElementById('entropy-chart');
            const ctx = canvas.getContext('2d');
            
            // Calculate entropy for chunks
            const chunkSize = Math.max(1, Math.floor(data.length / 100));
            const entropyData = [];
            
            for (let i = 0; i < data.length; i += chunkSize) {
                const chunk = data.slice(i, i + chunkSize);
                entropyData.push(calculateEntropy(chunk));
            }
            
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: entropyData.map((_, i) => i),
                    datasets: [{
                        label: 'Entropy',
                        data: entropyData,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            beginAtZero: true,
                            max: 8,
                            ticks: {
                                color: '#9ca3af'
                            },
                            grid: {
                                color: 'rgba(156, 163, 175, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        // Format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // Export to PDF
        function exportToPDF() {
            if (!currentFile) {
                alert('Please analyze a file first');
                return;
            }
            
            // Create PDF content
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Add title
            doc.setFontSize(20);
            doc.text('Binary Analysis Report', 20, 30);
            
            // Add file info
            doc.setFontSize(12);
            doc.text(`File: ${currentFile.name}`, 20, 50);
            doc.text(`Size: ${formatFileSize(currentFile.size)}`, 20, 60);
            doc.text(`Analysis Date: ${new Date().toLocaleString()}`, 20, 70);
            
            // Add VirusTotal results if available
            if (virusTotalData) {
                const stats = virusTotalData.data.attributes.last_analysis_stats;
                doc.text('VirusTotal Results:', 20, 90);
                doc.text(`Malicious: ${stats.malicious || 0}`, 30, 100);
                doc.text(`Suspicious: ${stats.suspicious || 0}`, 30, 110);
                doc.text(`Clean: ${stats.harmless || 0}`, 30, 120);
                doc.text(`Undetected: ${stats.undetected || 0}`, 30, 130);
            }
            
            // Save PDF
            doc.save(`${currentFile.name}_analysis.pdf`);
        }
    </script>
</body>
</html>

